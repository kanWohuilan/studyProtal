import{k as E,o as l,e as m,i as a,at as H,au as L,_ as A,r as G,W as I,bW as M,t as x,F as T,f as w,ak as U,b as k,d,h as i,am as q,N as j,ao as N,g as P,a as R,w as F,c as z,bX as S,ar as W,n as D}from"./entry-21db2f40.mjs";import{N as X}from"./Icon-8b068cec.mjs";import{a as J}from"./Input-16e77b41.mjs";import{_ as K}from"./TimeBox-caea4e56.mjs";import{N as Q,a as Y}from"./Grid-87bc6c3f.mjs";import{N as Z}from"./Tag-06ce51bd.mjs";import{N as $}from"./Divider-96cbb6d0.mjs";import"./use-merged-state-aa6f3d5b.mjs";import"./use-locale-d1b818a5.mjs";import"./get-slot-f07f150d.mjs";import"./next-frame-once-08317937.mjs";const ee={xmlns:"http://www.w3.org/2000/svg","xmlns:xlink":"http://www.w3.org/1999/xlink",viewBox:"0 0 512 512"},te=a("path",{d:"M289.94 256l95-95A24 24 0 0 0 351 127l-95 95l-95-95a24 24 0 0 0-34 34l95 95l-95 95a24 24 0 1 0 34 34l95-95l95 95a24 24 0 0 0 34-34z",fill:"currentColor"},null,-1),ae=[te];var se=E({name:"Close",render:function(y,s){return l(),m("svg",ee,ae)}});function ne(v){return L("SubmitTest","/user_test/save",{body:v})}function oe(v){return H("ReadTestpaper","/testpaper/read?id="+v)}const le={__name:"PaperTestItems",props:{item:Object,index:Number},emits:["change"],setup(v,{expose:y,emit:s}){y();const e=v,o=G(e.item.user_value),g={answer:"\u95EE\u7B54\u9898",completion:"\u586B\u7A7A\u9898",trueOrfalse:"\u5224\u65AD\u9898",checkbox:"\u591A\u9009\u9898",radio:"\u5355\u9009\u9898"},r={1:"A",2:"B",3:"C",4:"D",5:"E",6:"F",7:"G"};function n(u){const{item:h}=e;if(h.type=="radio"||h.type=="trueOrfalse")o.value=o.vallue==u?-1:u;else{let C=o.value.findIndex(t=>t==u);C==-1?o.value.push(u):o.value.splice(C,1)}}function c(u){const{item:h}=e;return h.type=="radio"||h.type=="trueOrfalse"?o.value==u:o.value.includes(u)}I(o,u=>{s("change",M(u))},{deep:!0});function _(u){const{dialog:h}=N(["dialog"]);h.warning({content:"\u662F\u5426\u8981\u5220\u9664\u8BE5\u586B\u7A7A\uFF1F",positiveText:"\u786E\u5B9A",negativeText:"\u53D6\u6D88",onPositiveClick:()=>{o.value.splice(u,1)}})}function p(){o.value.push("")}const b={props:e,modelValue:o,typeOptions:g,en:r,handleChooseOption:n,isActive:c,emit:s,remove:_,add:p,NIcon:X,NInput:J,NButton:j,createDiscreteApi:N,Close:se};return Object.defineProperty(b,"__isScriptSetup",{enumerable:!1,value:!0}),b}},ie={class:"test-item"},re={class:"title"},ce={class:"p-4"},ue=["innerHTML"],de={key:0},_e=a("p",{class:"tip"},"\u7B54\u6848\uFF1A",-1),me=["onClick"],pe={class:"mr-2"},fe=["innerHTML"],ve={key:1},he={class:"flex items-center justify-between mb-3"},xe={class:"text-sm"},ye=P(" \u6DFB\u52A0\u586B\u7A7A "),ge={key:2},be={class:"mb-3 border rounded p-3"};function Ne(v,y,s,e,o,g){return l(),m("div",ie,[a("div",re," \u7B2C"+x(s.index+1)+"\u9898 "+x(e.typeOptions[s.item.type]),1),a("div",ce,[a("p",{class:"mb-5",innerHTML:s.item.title},null,8,ue),s.item.type=="radio"||s.item.type=="trueOrfalse"||s.item.type=="checkbox"?(l(),m("div",de,[_e,a("ul",null,[(l(!0),m(T,null,w(s.item.options,(r,n)=>(l(),m("li",{class:U(["option",{active:e.isActive(n)}]),key:n,onClick:c=>e.handleChooseOption(n)},[a("span",pe,x(e.en[n]),1),a("div",{innerHTML:r},null,8,fe)],10,me))),128))])])):s.item.type=="completion"?(l(),m("div",ve,[(l(!0),m(T,null,w(e.modelValue,(r,n)=>(l(),m("div",{class:"mb-3 border rounded p-3",key:n},[a("div",he,[a("h5",xe,"\u586B\u7A7A "+x(n+1),1),n>0?(l(),k(e.NIcon,{key:0,onClick:c=>e.remove(n)},{default:d(()=>[i(e.Close)]),_:2},1032,["onClick"])):q("",!0)]),i(e.NInput,{value:e.modelValue[n],"onUpdate:value":c=>e.modelValue[n]=c,type:"textarea",placeholder:"\u586B\u7A7A "+(n+1)},null,8,["value","onUpdate:value","placeholder"])]))),128)),i(e.NButton,{type:"primary",dashed:"",class:"w-full my-3",onClick:e.add},{default:d(()=>[ye]),_:1})])):(l(),m("div",ge,[a("div",be,[i(e.NInput,{value:e.modelValue[0],"onUpdate:value":y[0]||(y[0]=r=>e.modelValue[0]=r),type:"textarea",placeholder:"\u8BF7\u586B\u5199\u5185\u5BB9",clearable:""},null,8,["value"])])]))])])}var Ce=A(le,[["render",Ne]]);const ke={__name:"[id]",async setup(v,{expose:y}){y();let s,e;const o=R();let{data:g}=([s,e]=F(()=>oe(o.params.id)),s=await s,e(),s);const r=z(()=>g.value?g.value.testpaper_questions.map(t=>(t.isTest=!1,t)):[]);function n(t,f){t.user_value=f,c()}function c(){r.value.forEach(t=>{let f=!1;t.type=="answer"||t.type=="completion"?f=!!t.user_value[0]:t.type=="radio"||t.type=="trueOrfalse"?f=t.user_value!=-1:f=t.user_value.length>0,t.isTest=f})}function _(t){const f=document.getElementById("question_"+t);window.scrollTo(0,f.offsetTop)}const p=G(!0);S((t,f,B)=>{if(!p.value)B();else{const{dialog:O}=N(["dialog"]);O.warning({content:"\u662F\u5426\u8981\u653E\u5F03\u8003\u8BD5\uFF1F",positiveText:"\u786E\u5B9A",negativeText:"\u53D6\u6D88",onPositiveClick(){p.value=!1,D(t.fullPath||"/",{replace:!0})}}),B(!1)}});const b=G(!1);async function u(){const{message:t}=N(["message"]);if(r.value.filter(V=>!V.isTest).length>0)return t.warning("\u8FD8\u6709\u9898\u76EE\u6CA1\u6709\u5B8C\u6210\uFF0C\u8BF7\u68C0\u67E5");b.value=!0;const{data:B,error:O}=await ne({user_test_id:g.value.user_test_id,value:r.value.map(V=>V.user_value)});b.value=!1,!O.value&&(p.value=!1,t.success("\u4EA4\u5377\u6210\u529F"),D("/paper/1",{replace:!0}))}function h(){const{dialog:t}=N(["dialog"]);t.success({content:"\u8003\u8BD5\u65F6\u95F4\u5230\uFF0C\u8BD5\u5377\u5DF2\u5F3A\u5236\u63D0\u4EA4",positiveText:"\u786E\u8BA4",closable:!1,onPositiveClick(){p.value=!1,D("/paper/1",{replace:!0})}})}const C={route:o,data:g,testpaper_questions:r,handleUserValueChange:n,updateIsTest:c,scrollToDom:_,disableBack:p,loading:b,submit:u,autoSubmit:h,onBeforeRouteLeave:S,NGrid:Q,NGridItem:Y,NButton:j,NTag:Z,NCard:W,NDivider:$,createDiscreteApi:N};return Object.defineProperty(C,"__isScriptSetup",{enumerable:!1,value:!0}),C}},Te={class:"text-center font-bold"},we={class:"space-x-5 text-sm text-center"},Be={class:"flex flex-col items-center justify-center"},Oe=a("small",{class:"text-gray-500 mb-1"},"\u5269\u4F59\u65F6\u95F4",-1),Ve=P("\u4EA4 \u5377");function De(v,y,s,e,o,g){const r=Ce,n=K;return l(),k(e.NGrid,{"x-gap":20},{default:d(()=>[i(e.NGridItem,{span:18},{default:d(()=>[i(e.NCard,null,{header:d(()=>[a("h3",Te,x(e.data.title),1),i(e.NDivider),a("p",we,[a("span",null,"\u9898\u76EE\u603B\u6570\uFF1A"+x(e.data.testpaper_questions.length),1),a("span",null,"\u603B\u5206\u6570\uFF1A"+x(e.data.total_score),1),a("span",null,"\u65F6\u95F4\uFF1A"+x(e.data.expire)+"\u5206\u949F",1)])]),default:d(()=>[(l(!0),m(T,null,w(e.testpaper_questions,(c,_)=>(l(),k(r,{key:_,item:c,index:_,onChange:p=>e.handleUserValueChange(c,p),id:"question_"+_},null,8,["item","index","onChange","id"]))),128))]),_:1})]),_:1}),i(e.NGridItem,{span:6},{default:d(()=>[i(e.NCard,null,{header:d(()=>[a("div",Be,[Oe,i(n,{expire:e.data.expire,class:"text-3xl text-light-blue-600",onEnd:e.autoSubmit},null,8,["expire"])])]),default:d(()=>[i(e.NGrid,{"x-gap":12,cols:4},{default:d(()=>[(l(!0),m(T,null,w(e.testpaper_questions,(c,_)=>(l(),k(e.NGridItem,{key:_},{default:d(()=>[i(e.NTag,{class:"mb-2 w-full cursor-pointer flex items-center justify-center",type:c.isTest?"success":"",onClick:p=>e.scrollToDom(_)},{default:d(()=>[P(x(_+1),1)]),_:2},1032,["type","onClick"])]),_:2},1024))),128))]),_:1}),i(e.NDivider),a("div",null,[i(e.NButton,{type:"primary",class:"w-full",onClick:e.submit,loading:e.loading},{default:d(()=>[Ve]),_:1},8,["loading"])])]),_:1})]),_:1})]),_:1})}var qe=A(ke,[["render",De]]);export{qe as default};
